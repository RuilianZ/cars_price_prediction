---
title: "Used Cars Price Prediction - Analysis"
author: "Roxy Zhang"
date: "3/21/2022"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
library(tidyverse)
library(stringr) # for data cleaning
library(patchwork) # align plots

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .7,
  out.width = "95%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
```


## Objective
To predict the costs of used cars given the data collected from various sources and distributed across various locations in India.


## Features from the original data
Name: The brand and model of the car.  
Location: The location in which the car is being sold or is available for purchase.  
Year: The year or edition of the model.  
Kilometers_Driven: The total kilometres driven in the car by the previous owner(s) in KM.  
Fuel_Type: The type of fuel used by the car.  
Transmission: The type of transmission used by the car.  
Owner_Type: Whether the ownership is Firsthand, Second hand or other.  
Mileage: The standard mileage offered by the car company in kmpl or km/kg.  
Engine: The displacement volume of the engine in cc.  
Power: The maximum power of the engine in bhp.  
Seats: The number of seats in the car.  
New_Price: The price of a new car of the same model.  
Price: The price of the used car in INR Lakhs.  


## Data cleaning

```{r}
# data import and cleaning
ord_owner_type = c("First", "Second", "Third", "Fourth")

car = read_csv("data.csv") %>% 
  janitor::clean_names() %>% 
  select(- c(x1, new_price)) %>% 
  drop_na() %>% 
  filter(power != "null bhp") %>% 
  mutate(
    price = round(price * 1309.57, 0),
    name = gsub(" .*$", "", name),
    engine = gsub(" CC", "", engine),
    mileage = gsub(" .*$", "", mileage),
    power = gsub(" bhp", "", power),
    owner_type = gsub(" & Above", "", owner_type)) %>% 
  mutate(
    engine = as.numeric(engine),
    mileage = as.numeric(mileage),
    power = as.numeric(power),
    name = as.factor(name),
    location = as.factor(location),
    fuel_type = as.factor(fuel_type),
    transmission = as.factor(transmission),
    owner_type = as.factor(owner_type),
    owner_type = fct_relevel(owner_type, ord_owner_type),
    seats = as.factor(seats)
  ) %>% 
  select(name, location, fuel_type, transmission, owner_type, seats, everything())

range(car$year)

# check for NA
colSums(is.na(car))
```

For the response variable `price`, the original data used 100000 Indian Rupee as unit. For better illustration, we transformed it to USD, using the exchange rate of 100000 Indian Rupee equals to 1309.75 USD on March 21, 2022.  
For numeric variables with unit, the units are deleted for model-building.


## Exploratory Data Analysis

```{r}
# look at data summary
dim(car)

summary(car)

skimr::skim(car)
```

There are 11 predictors and 1 response variable - `price`.  
5 of the predictors are numeric, and the other 6 of them are categorical.

```{r}
# visualization for categorical variables

theme_set(
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + 
  theme(legend.position = "none"))

p1 = car %>% 
  ggplot(aes(x = fuel_type, y = price, fill = fuel_type)) +
  geom_boxplot()

p2 = car %>% 
  ggplot(aes(x = transmission, y = price, fill = transmission)) +
  geom_boxplot()

p3 = car %>% 
  ggplot(aes(x = owner_type, y = price, fill = owner_type)) +
  geom_boxplot()

p4 = car %>% 
  ggplot(aes(x = owner_type, y = price, fill = owner_type)) +
  geom_boxplot()

p5 = car %>% 
  ggplot(aes(x = seats, y = price, fill = seats)) +
  geom_boxplot()

(p1 + p2)/(p3 + p4)/(p5)
```

## Data preprocessig

```{r}
# center/scale

```


